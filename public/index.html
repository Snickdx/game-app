<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template App</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <style>
      
    header, main, footer {
      padding-left: 300px;
    }

    @media only screen and (max-width : 992px) {
      header, main, footer {
        padding-left: 0;
      }
    }

    .game-tile{
      padding:5px;
    }

    .game-tile > div {
      border-radius: 25px;
      height: 150px;
      box-sizing: border-box;
    }
    </style>  
</head>
<body>
  
    <nav>
      <div class="nav-wrapper">
        <a href="#" data-target="slide-out" class="sidenav-trigger show-on-large"><i class="material-icons">menu</i></a>
        <a href="#" class="brand-logo">Games R Us</a>
      </div>
    </nav>
    

    <ul id="slide-out" class="sidenav sidenav-fixed">
    
      <nav style="padding-left: 10px;">
        <span class="white-text">Not Logged In</span>
      </nav>
      
      <nav>
        <div class="row center">
          <button class="btn waves-effect waves-light" name="action">
            Login
          </button>
          <button class="btn waves-effect waves-light" name="action">
            Sign Up
          </button>
        </div>  
      </nav> 

      <li><a href="#!">Browse Games</a></li>
      <li><a href="#!">Profile</a></li>

    </ul>
        
      <main class="container">
        <h1>Browse Games</h1>

        <section class="row" id="result">
          



      

        </section>

        <!-- Modal Structure -->
        <div id="modal1" class="modal">

        </div>

      </main>
    
    <script src="data.js"></script>

    <script>

        const clientId = "szheafgfevm6hxw5xgf5lnz6vvmdea";
        const token = "1epxp3nkwrjygmmnksw8bbin3xrj8w";

        async function loadGames(){

          // let requestOptions = {
          //   method: 'POST',
          //   headers: {
          //     "Client-ID": clientId,
          //     "Authorization": `Bearer ${token}`,
          //     "Content-Type": "text/plain"
          //   },
          //   body: "fields name,cover,genres,summary,url;",
          //   redirect: 'follow'
          // };

          // let response = await fetch("https://api.igdb.com/v4/games", requestOptions)
          // let result = await response.json();

          drawGames(games);
        }

        function drawGames(games){
          let result = document.querySelector('#result');
          let html = '';

          for(let game of games){
            html+=`
       
              <div class="col s6 m4 game-tile">
                <div class="card-panel card-panel teal center">
                  <div class="white-text truncate flow-text">
                    ${game.name}
                  </div>
                  <a href='#${game.id}' class="white-text" onclick='showDetails(${game.id})'>Details</a>
                </div>  
              </div>
              
           
          `;
          }

          result.innerHTML = html;
        }



        loadGames()

        async function getGame(gameId){
          //peform http request to get game details

          //api not working so its mocked here instead
          // console.log(games.map(game=>game.id).join(','))

          return games.filter(game=> game.id === gameId)[0];
        }

        async function getGameCover(gameId){
          let [cover, ...rest] =  covers.filter(cover => cover.game == gameId);
          console.log(gameId, cover);
          return cover ? cover.url : 'https://via.placeholder.com/250';
        }

        async function showDetails(gameId){
          const modalhtml = document.querySelector('#modal1');
          const modal = M.Modal.init(modalhtml);

          const game = await getGame(gameId);

          modalhtml.innerHTML = `
            <div class="modal-content">
              <h4>${game.name}</h4>
              <img class="materialboxed" src="${await getGameCover(game.id)}">
              <p>${game.summary}</p>
            </div>
            <div class="modal-footer">
              <a href="${game.url}" target="_blank" class="modal-close waves-effect waves-green btn-flat">View on IGDB</a>
              <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
            </div>
          `;

          console.log(game);

          modal.open();

        }


        document.addEventListener('DOMContentLoaded', function() {
          M.AutoInit();
        });

    </script>
    
</body>
</html>